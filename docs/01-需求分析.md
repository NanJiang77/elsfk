# 俄罗斯方块游戏 - 需求分析文档

## 📌 项目概述

**项目名称**: 俄罗斯方块 (elsfk)
**项目类型**: 学习项目
**开发目标**: 完成一个完整的、可运行的单人俄罗斯方块游戏
**项目路径**: `/Users/nanjiang/codebase/elsfk`

---

## 🎯 核心需求

### 1. 游戏模式
- ✅ **单人游戏模式**: 玩家独自游玩，挑战自己的最高分
- ❌ 多人对战模式 (不需要)
- ❌ 用户登录系统 (不需要)

---

## 🎮 游戏功能需求

### 2.1 基础游戏功能
- **标准俄罗斯方块逻辑**
  - 7种标准方块（I, O, T, S, Z, J, L）
  - 方块自动下落
  - 方块左右移动
  - 方块旋转（顺时针/逆时针）
  - 方块快速下落（软降）
  - 方块直接落地（硬降）
  - 碰撞检测
  - 行消除逻辑
  - 游戏结束检测（方块堆叠到顶部）

### 2.2 游戏控制系统
- **键盘操作**（不区分大小写）
  - ← → : 左右移动
  - ↑ : 旋转
  - ↓ : 加速下落
  - 空格 : 瞬间落地（硬降）
  - P/p : 暂停/继续
  - R/r : 重新开始
- **全局快捷键**: 所有快捷键均支持全局响应，无需聚焦游戏区域

### 2.3 分数系统
- **计分规则**
  - 消除1行: 100分
  - 消除2行: 300分
  - 消除3行: 500分
  - 消除4行（Tetris）: 800分
- **等级系统**
  - 每消除20行升一级
  - 等级越高，下落速度越快（采用非线性递减公式）
  - 速度公式: 下落间隔(ms) = 1000 / (1 + (等级-1) × 0.1)
  - 等级1: 1000ms，等级5: 667ms，等级10: 476ms，等级15: 370ms，等级20: 303ms

### 2.4 游戏状态管理
- **游戏状态**
  - 未开始（菜单界面）
  - 游戏进行中
  - 暂停
  - 游戏结束
- **用户名系统**
  - 首次访问需输入用户名（2-20字符）
  - 用户名持久化存储（localStorage）
  - 跨会话保持登录状态
  - 游戏记录关联用户名
- **数据持久化**
  - 本地存储最高分（localStorage）
  - 后端记录历史游戏记录（包含用户名）
  - WebSocket实时排行榜更新

---

## 🎨 界面需求

### 3.1 游戏界面
- **游戏主区域**: 10列 × 20行的方块网格（Canvas渲染）
- **下一个方块预览区**: 显示即将出现的方块（Canvas渲染）
- **信息面板**:
  - 玩家名称
  - 当前分数
  - 最高分
  - 当前等级
  - 已消除行数
- **操作说明面板**: 显示所有快捷键操作
- **控制按钮**:
  - 开始游戏
  - 暂停/继续
  - 重新开始
- **用户名对话框**: 首次访问时弹出

### 3.2 UI/UX 要求
- 简洁清晰的设计
- 流畅的动画效果
- 响应式布局（适配不同屏幕）
- 友好的操作提示

---

## 🏗️ 技术架构

### 4.1 前端技术栈
- **框架**: Vue 3 + TypeScript
- **渲染**: HTML5 Canvas
- **状态管理**: Pinia
- **UI库**: Element Plus (用于按钮、面板等UI组件)
- **构建工具**: Vite

### 4.2 后端技术栈
- **语言**: Python 3.10+
- **框架**: FastAPI
- **功能**:
  - 提供游戏记录保存API
  - 提供排行榜查询API
  - 静态文件服务
- **数据库**: SQLite (简单轻量，适合学习项目)

### 4.3 前后端通信
- **API协议**: RESTful API
- **数据格式**: JSON
- **实时通信**: WebSocket（排行榜实时更新）

---

## 📊 数据结构设计

### 5.1 游戏记录（后端存储）
```json
{
  "id": 1,
  "player_name": "张三",
  "score": 5000,
  "level": 8,
  "lines": 45,
  "play_time": 180,
  "created_at": "2026-01-20T10:30:00"
}
```

### 5.2 本地最高分（浏览器存储）
```json
{
  "highest_score": 10000,
  "games_played": 20
}
```

---

## 🚀 开发阶段规划

### 阶段1: 需求分析 ✅
- 明确项目目标和功能范围
- 确定技术栈
- 输出需求文档

### 阶段2: 架构设计
- 设计系统架构
- 设计数据库结构
- 设计API接口
- 规划项目目录结构

### 阶段3: 后端开发
- 搭建FastAPI项目
- 实现数据库模型
- 实现API接口
- 编写测试

### 阶段4: 前端开发
- 搭建Vue 3项目
- 实现游戏核心逻辑
- 实现UI界面
- 实现与后端的交互

### 阶段5: 联调测试
- 前后端集成
- 功能测试
- 性能优化

### 阶段6: 部署运行
- 本地运行
- 编写使用说明

---

## ✅ 项目验收标准

1. ✅ 游戏可以正常启动、暂停、重新开始
2. ✅ 所有游戏控制功能正常工作（包括全局快捷键）
3. ✅ 分数计算正确
4. ✅ 等级系统正常运作（每20行升一级）
5. ✅ 游戏结束判定准确
6. ✅ 最高分能够保存
7. ✅ 可以查看历史游戏记录
8. ✅ 界面友好，操作流畅
9. ✅ 用户名系统完整（输入、持久化、显示）
10. ✅ 排行榜实时更新（WebSocket）
11. ✅ 前端组件化架构（GameBoard、PieceRenderer、GameCanvas）
12. ✅ 代码分割优化（vue-vendor、element-plus、game-engine）

---

## 📝 备注

- 这是一个学习项目，重点是理解完整的开发流程
- 代码将保持清晰可读，添加必要的注释
- 优先保证功能完整性，其次考虑性能优化
- 鼓励在开发过程中提出问题和建议

---

**文档版本**: v2.0
**创建日期**: 2026-01-20
**最后更新**: 2026-01-22
**更新内容**:
- 新增用户名系统需求
- 更新快捷键为全局响应
- 新增WebSocket实时通信
- 新增组件化架构要求
- 更新数据结构包含player_name
