<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>è°ƒè¯• - APIè¿æ¥</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1e293b;
            color: #f1f5f9;
        }
        .section {
            margin: 20px 0;
            padding: 15px;
            background: rgba(30, 41, 59, 0.5);
            border-radius: 8px;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            background: #6366f1;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover { background: #818cf8; }
        pre {
            background: rgba(0,0,0,0.3);
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
        .success { color: #22c55e; }
        .error { color: #ef4444; }
        .info { color: #3b82f6; }
    </style>
</head>
<body>
    <h1>ğŸ” APIè¿æ¥è°ƒè¯•</h1>

    <div class="section">
        <h2>1. ç¯å¢ƒä¿¡æ¯</h2>
        <pre id="env">åŠ è½½ä¸­...</pre>
    </div>

    <div class="section">
        <h2>2. æµ‹è¯•1: Fetch API (ç›´æ¥è°ƒç”¨)</h2>
        <button onclick="test1()">æµ‹è¯• fetch('http://localhost:8000/api/leaderboard')</button>
        <pre id="test1">ç­‰å¾…æµ‹è¯•...</pre>
    </div>

    <div class="section">
        <h2>3. æµ‹è¯•2: Fetch API (ç›¸å¯¹è·¯å¾„)</h2>
        <button onclick="test2()">æµ‹è¯• fetch('/api/leaderboard')</button>
        <pre id="test2">ç­‰å¾…æµ‹è¯•...</pre>
    </div>

    <div class="section">
        <h2>4. æµ‹è¯•3: Axios (å¦‚æœå¯ç”¨)</h2>
        <button onclick="test3()">æµ‹è¯• axios.get('/api/leaderboard')</button>
        <pre id="test3">ç­‰å¾…æµ‹è¯•...</pre>
    </div>

    <div class="section">
        <h2>5. ç½‘ç»œè¯·æ±‚ç›‘æ§</h2>
        <p class="info">æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· (F12) â†’ Network æ ‡ç­¾ï¼Œç„¶åç‚¹å‡»ä¸Šé¢çš„æµ‹è¯•æŒ‰é’®</p>
        <p class="info">æŸ¥çœ‹å®é™…å‘é€çš„è¯·æ±‚URLå’Œå“åº”</p>
    </div>

    <script>
        // æ˜¾ç¤ºç¯å¢ƒä¿¡æ¯
        document.getElementById('env').textContent = `
å½“å‰URL: ${window.location.href}
Hostname: ${window.location.hostname}
Port: ${window.location.port}
Protocol: ${window.location.protocol}
        `.trim();

        // æµ‹è¯•1: ç›´æ¥è°ƒç”¨
        async function test1() {
            const output = document.getElementById('test1');
            output.textContent = 'æµ‹è¯•ä¸­...';

            try {
                const response = await fetch('http://localhost:8000/api/leaderboard?limit=3');
                const data = await response.json();

                output.innerHTML = `<span class="success">âœ… æˆåŠŸ!</span>\n\nçŠ¶æ€ç : ${response.status}\næ•°æ®æ¡æ•°: ${data.length}\n\næ•°æ®:\n${JSON.stringify(data, null, 2)}`;
            } catch (error) {
                output.innerHTML = `<span class="error">âŒ å¤±è´¥!</span>\n\né”™è¯¯: ${error.message}\n\nå¯èƒ½åŸå› : CORSé”™è¯¯\nè¯¦ç»†ä¿¡æ¯: ${error.stack}`;
            }
        }

        // æµ‹è¯•2: ç›¸å¯¹è·¯å¾„ï¼ˆé€šè¿‡Viteä»£ç†ï¼‰
        async function test2() {
            const output = document.getElementById('test2');
            output.textContent = 'æµ‹è¯•ä¸­...';

            try {
                const response = await fetch('/api/leaderboard?limit=3');
                const data = await response.json();

                output.innerHTML = `<span class="success">âœ… æˆåŠŸ!</span>\n\nçŠ¶æ€ç : ${response.status}\næ•°æ®æ¡æ•°: ${data.length}\n\næ•°æ®:\n${JSON.stringify(data, null, 2)}\n\næ³¨æ„: æ­¤è¯·æ±‚é€šè¿‡Viteä»£ç†è½¬å‘åˆ°åç«¯`;
            } catch (error) {
                output.innerHTML = `<span class="error">âŒ å¤±è´¥!</span>\n\né”™è¯¯: ${error.message}\n\nå¯èƒ½åŸå› :\n1. Viteä»£ç†é…ç½®é”™è¯¯\n2. åç«¯æœåŠ¡æœªå¯åŠ¨\nè¯¦ç»†ä¿¡æ¯: ${error.stack}`;
            }
        }

        // æµ‹è¯•3: Axios
        async function test3() {
            const output = document.getElementById('test3');
            output.textContent = 'æµ‹è¯•ä¸­...';

            try {
                // åŠ¨æ€åŠ è½½axios
                if (!window.axios) {
                    output.textContent = 'åŠ è½½axiosä¸­...';
                    const script = document.createElement('script');
                    script.src = 'https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js';
                    document.head.appendChild(script);
                    await new Promise(resolve => script.onload = resolve);
                }

                const response = await window.axios.get('/api/leaderboard?limit=3');
                output.innerHTML = `<span class="success">âœ… æˆåŠŸ!</span>\n\nçŠ¶æ€ç : ${response.status}\næ•°æ®æ¡æ•°: ${response.data.length}\n\næ•°æ®:\n${JSON.stringify(response.data, null, 2)}`;
            } catch (error) {
                output.innerHTML = `<span class="error">âŒ å¤±è´¥!</span>\n\né”™è¯¯: ${error.message}\n\nå“åº”æ•°æ®: ${error.response ? JSON.stringify(error.response.data) : 'N/A'}\nè¯¦ç»†ä¿¡æ¯: ${error.stack}`;
            }
        }

        // é¡µé¢åŠ è½½æ—¶çš„æç¤º
        console.log('%cğŸ” è°ƒè¯•æ¨¡å¼', 'color: #6366f1; font-size: 20px; font-weight: bold');
        console.log('%cæ‰“å¼€Networkæ ‡ç­¾æŸ¥çœ‹è¯·æ±‚è¯¦æƒ…', 'color: #3b82f6; font-size: 14px');
    </script>
</body>
</html>
